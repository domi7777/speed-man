<html>
  <head>
    <title>Cross domain communication with popup</title>
    
  </head>
  <body>
    <h3>Cross domain communication - target</h3>
    
    <script>
    
    function output(message){
      document.body.innerHTML = document.body.innerHTML + "<p>"+message+"</p>";
    }
    var lastCartId = localStorage.getItem('cartId');
     output("last cartId:"+ lastCartId);
 
     window.opener.postMessage('hey, I\'m ready, previous cartId was:'+lastCartId,'*')
      
     window.addEventListener('message', function (event) {
       output("received cartId:"+event.data);
       localStorage.setItem('cartId',event.data);
       //window.close();
     });
       
      
    </script>
    
  </body>
</html>
